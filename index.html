 <!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Relay Avisha</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #1e293b; color: white; display: flex; justify-content: center; padding: 20px; }
        .card { background: #334155; padding: 20px; border-radius: 15px; width: 100%; max-width: 400px; text-align: center; }
        .status { padding: 10px; margin-bottom: 20px; border-radius: 8px; font-weight: bold; }
        .offline { background: #ef4444; } .online { background: #22c55e; }
        .btn { background: #3b82f6; border: none; padding: 15px; color: white; border-radius: 10px; width: 100%; cursor: pointer; margin: 5px 0; font-size: 16px; }
        .btn:active { background: #2563eb; }
    </style>
</head>
<body>

<div class="card">
    <h2>Smart Dashboard</h2>
    <div id="statusBox" class="status offline">Status: Disconnected</div>
    
    <button class="btn" onclick="startConnect()">1. KLIK KONEK MQTT</button>
    <hr>
    <button class="btn" style="background:#fbbf24; color:black;" onclick="sendCmd('Lampu 1', 'ON')">Lampu 1 ON</button>
    <button class="btn" style="background:#475569;" onclick="sendCmd('Lampu 1', 'OFF')">Lampu 1 OFF</button>
</div>

<script>
    let client;
    const MQTT_USER = "Arudammediatech_mqtt";
    const MQTT_PASS = "Qwerty12345"; // <--- WAJIB DIISI

    function startConnect() {
        document.getElementById("statusBox").innerText = "Connecting...";
        client = new Paho.MQTT.Client("broker.avisha.id", 8084, "web_" + Math.random());
        
        client.connect({
            userName: MQTT_USER,
            password: MQTT_PASS,
            useSSL: true, // Wajib True untuk GitHub
            onSuccess: () => {
                document.getElementById("statusBox").innerText = "Status: Terhubung!";
                document.getElementById("statusBox").className = "status online";
                client.subscribe(MQTT_USER + "/#");
            },
            onFailure: (e) => {
                alert("Gagal konek: " + e.errorMessage);
                document.getElementById("statusBox").className = "status offline";
            }
        });
    }

    function sendCmd(lampu, state) {
        if (!client || !client.connected) { alert("Klik Konek MQTT dulu!"); return; }
        let message = new Paho.MQTT.Message(state);
        message.destinationName = MQTT_USER + "/" + lampu;
        client.send(message);
    }
</script>

</body>
</html>
